<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Mobile</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(180deg,#0f172a,#020617);
  color: #111;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 14px;
}

.header {
  background:#1e293b;
  color:white;
  border-radius:16px;
  padding:12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.summary {
  background:white;
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  text-align:center;
  font-weight:600;
}

.summary div span {
  display:block;
  font-size:18px;
}

.green { color:#16a34a; }
.red { color:#dc2626; }
.blue { color:#2563eb; }

.buttons {
  display:flex;
  gap:10px;
  margin:12px 0;
}

button {
  flex:1;
  border:none;
  border-radius:999px;
  padding:10px;
  font-weight:600;
  color:white;
  cursor:pointer;
}

.btn-chart { background:#f59e0b; }
.btn-backup { background:#22c55e; }
.btn-import { background:#3b82f6; }

.month {
  background:white;
  border-radius:14px;
  margin-bottom:10px;
  padding:10px;
}

.month-header {
  display:flex;
  justify-content:space-between;
  font-weight:700;
  cursor:pointer;
}

.detail {
  display:none;
  margin-top:10px;
}

.row {
  display:flex;
  gap:6px;
  margin-bottom:6px;
}

.row input, .row select {
  flex:1;
  padding:6px;
  border-radius:8px;
  border:1px solid #ddd;
}

.row button {
  flex:0.3;
  background:#ef4444;
}

.add-btn {
  background:#22c55e;
  margin-top:6px;
}

canvas {
  background:white;
  border-radius:12px;
  padding:10px;
  margin-top:10px;
  display:none;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
  <div>üìä Budget Mobile</div>
  <div style="color:#22c55e;">‚óè Online</div>
</div>

<div class="summary">
  <div>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö<span id="totalIncome" class="green">0</span></div>
  <div>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢<span id="totalExpense" class="red">0</span></div>
  <div>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠<span id="totalBalance" class="blue">0</span></div>
</div>

<div class="buttons">
  <button class="btn-chart" onclick="toggleChart()">‡∏Å‡∏£‡∏≤‡∏ü</button>
  <button class="btn-backup" onclick="backup()">Backup</button>
  <button class="btn-import" onclick="importData()">Import</button>
</div>

<canvas id="chart"></canvas>

<div id="months"></div>

<input type="file" id="fileInput" hidden />

</div>

<script>
const months = ["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];
let data = JSON.parse(localStorage.getItem("budget-data")) || {};
let chart;

const monthsDiv = document.getElementById("months");

months.forEach((m,i)=>{
  if(!data[i]) data[i] = [];

  const div = document.createElement("div");
  div.className = "month";

  div.innerHTML = `
    <div class="month-header" onclick="toggleDetail(${i})">
      <div>${m}</div>
      <div id="sum-${i}">0</div>
    </div>
    <div class="detail" id="detail-${i}">
      <div id="rows-${i}"></div>
      <button class="add-btn" onclick="addRow(${i})">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </div>
  `;
  monthsDiv.appendChild(div);
  renderRows(i);
});

function toggleDetail(i){
  const el = document.getElementById("detail-"+i);
  el.style.display = el.style.display === "block" ? "none" : "block";
}

function addRow(i){
  data[i].push({ type:"income", text:"", amount:0 });
  save();
  renderRows(i);
}

function renderRows(i){
  const box = document.getElementById("rows-"+i);
  box.innerHTML = "";
  data[i].forEach((r,index)=>{
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <select onchange="updateRow(${i},${index},'type',this.value)">
        <option value="income" ${r.type==="income"?"selected":""}>‡∏£‡∏±‡∏ö</option>
        <option value="expense" ${r.type==="expense"?"selected":""}>‡∏à‡πà‡∏≤‡∏¢</option>
      </select>
      <input placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" value="${r.text}" 
        oninput="updateRow(${i},${index},'text',this.value)">
      <input type="number" value="${r.amount}" 
        oninput="updateRow(${i},${index},'amount',this.value)">
      <button onclick="removeRow(${i},${index})">‚úï</button>
    `;
    box.appendChild(row);
  });
  calculate();
}

function updateRow(i,index,key,value){
  data[i][index][key] = key==="amount" ? Number(value) : value;
  save();
  calculate();
}

function removeRow(i,index){
  data[i].splice(index,1);
  save();
  renderRows(i);
}

function calculate(){
  let totalIncome=0,totalExpense=0;
  const incomes=[], expenses=[];

  months.forEach((_,i)=>{
    let inc=0, exp=0;
    data[i].forEach(r=>{
      if(r.type==="income") inc+=r.amount;
      else exp+=r.amount;
    });
    document.getElementById("sum-"+i).innerText = inc-exp;
    totalIncome+=inc;
    totalExpense+=exp;
    incomes.push(inc);
    expenses.push(exp);
  });

  document.getElementById("totalIncome").innerText = totalIncome;
  document.getElementById("totalExpense").innerText = totalExpense;
  document.getElementById("totalBalance").innerText = totalIncome-totalExpense;

  drawChart(incomes,expenses);
}

function save(){
  localStorage.setItem("budget-data",JSON.stringify(data));
}

function backup(){
  const blob = new Blob([JSON.stringify(data)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "budget-backup.json";
  a.click();
}

function importData(){
  document.getElementById("fileInput").click();
}

fileInput.onchange = e=>{
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ()=>{
    data = JSON.parse(reader.result);
    save();
    location.reload();
  };
  reader.readAsText(file);
};

function toggleChart(){
  const c = document.getElementById("chart");
  c.style.display = c.style.display==="block"?"none":"block";
}

function drawChart(incomes,expenses){
  const ctx = document.getElementById("chart");
  if(chart) chart.destroy();
  chart = new Chart(ctx,{
    type:"scatter",
    data:{
      datasets:[{
        label:"‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö vs ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢",
        data: incomes.map((v,i)=>({x:expenses[i],y:v}))
      }]
    },
    options:{
      scales:{
        x:{title:{display:true,text:"‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢"}},
        y:{title:{display:true,text:"‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö"}}
      }
    }
  });
}

calculate();
</script>
</body>
</html>
