<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Budget Mobile</title>

<link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Budget%20Mobile%22,%22short_name%22:%22Budget%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22theme_color%22:%22%234f7cff%22}">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ================= BASE ================= */
* { box-sizing: border-box; max-width:100%; }

html, body {
  margin:0;
  padding:0;
  background:#0f172a;
  font-family: system-ui, -apple-system, sans-serif;
  color:#111;
  overflow-x:hidden;
}

.container {
  max-width: 1000px;
  margin:auto;
  padding:16px;
}

/* ================= HEADER ================= */
.header {
  background:#1e293b;
  border-radius:18px;
  padding:12px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  color:white;
}

.badge {
  background:#22c55e;
  padding:4px 12px;
  border-radius:999px;
  font-size:12px;
}

/* ================= SUMMARY ================= */
.summary {
  background:white;
  margin-top:12px;
  border-radius:16px;
  display:flex;
  justify-content:space-around;
  padding:12px;
  font-weight:600;
}

.green { color:#16a34a; }
.red { color:#dc2626; }
.blue { color:#2563eb; }

/* ================= BUTTONS ================= */
.buttons {
  display:flex;
  gap:10px;
  margin:14px 0;
}

button {
  flex:1;
  border:none;
  border-radius:999px;
  padding:12px;
  font-size:15px;
  font-weight:600;
  color:white;
}

.btn-graph { background:#f59e0b; }
.btn-backup { background:#22c55e; }
.btn-import { background:#3b82f6; }

/* ================= MONTH CARD ================= */
.month {
  background:white;
  border-radius:16px;
  padding:12px;
  margin-bottom:12px;
}

.month-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
}

.month-body {
  display:none;
  margin-top:10px;
}

.row {
  display:flex;
  gap:8px;
  margin-bottom:6px;
}

input, select {
  flex:1;
  padding:8px;
  border-radius:10px;
  border:1px solid #ddd;
}

.add-btn {
  background:#16a34a;
}

.remove-btn {
  background:#dc2626;
}

/* ================= CHART ================= */
canvas {
  background:white;
  border-radius:16px;
  padding:10px;
  margin-top:20px;
}

/* ================= MOBILE FIX ================= */
@media (max-width: 600px) {
  .summary { font-size:14px; }
  button { font-size:14px; padding:10px; }
}
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <div>üìä Budget Mobile</div>
    <div class="badge">Online</div>
  </div>

  <div class="summary">
    <div>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö<br><span id="totalIncome" class="green">0</span></div>
    <div>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢<br><span id="totalExpense" class="red">0</span></div>
    <div>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠<br><span id="totalBalance" class="blue">0</span></div>
  </div>

  <div class="buttons">
    <button class="btn-graph" onclick="toggleChart()">‡∏Å‡∏£‡∏≤‡∏ü</button>
    <button class="btn-backup" onclick="backupData()">Backup</button>
    <button class="btn-import" onclick="importData()">Import</button>
  </div>

  <div id="months"></div>

  <canvas id="chart" height="180" style="display:none;"></canvas>

</div>

<script>
/* ================= DATA ================= */
const monthNames = ["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];
let data = JSON.parse(localStorage.getItem("budgetData") || "[]");
if (data.length === 0) {
  data = monthNames.map(()=>({ salary:0, extra:0, items:[] }));
}

const monthsDiv = document.getElementById("months");

/* ================= RENDER ================= */
function render() {
  monthsDiv.innerHTML = "";
  let totalIncome = 0;
  let totalExpense = 0;

  data.forEach((m, i) => {
    let income = m.salary + m.extra;
    let expense = 0;

    m.items.forEach(it=>{
      if(it.type==="income") income += it.amount;
      else expense += it.amount;
    });

    totalIncome += income;
    totalExpense += expense;

    const div = document.createElement("div");
    div.className = "month";
    div.innerHTML = `
      <div class="month-header" onclick="toggleMonth(${i})">
        <div>${monthNames[i]}</div>
        <div>${income-expense}</div>
      </div>

      <div class="month-body" id="body-${i}">
        <div class="row">
          <input type="number" value="${m.salary}" placeholder="‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" 
            oninput="data[${i}].salary=this.valueAsNumber||0;save();">
          <input type="number" value="${m.extra}" placeholder="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏û‡∏¥‡πÄ‡∏®‡∏©" 
            oninput="data[${i}].extra=this.valueAsNumber||0;save();">
        </div>

        ${m.items.map((it,idx)=>`
          <div class="row">
            <select onchange="data[${i}].items[${idx}].type=this.value;save();">
              <option ${it.type==="income"?"selected":""}>income</option>
              <option ${it.type==="expense"?"selected":""}>expense</option>
            </select>
            <input value="${it.name}" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
              oninput="data[${i}].items[${idx}].name=this.value;save();">
            <input type="number" value="${it.amount}" 
              oninput="data[${i}].items[${idx}].amount=this.valueAsNumber||0;save();">
            <button class="remove-btn" onclick="data[${i}].items.splice(${idx},1);save();">‚úï</button>
          </div>
        `).join("")}

        <button class="add-btn" onclick="data[${i}].items.push({type:'expense',name:'',amount:0});save();">
          ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </button>
      </div>
    `;
    monthsDiv.appendChild(div);
  });

  document.getElementById("totalIncome").innerText = totalIncome;
  document.getElementById("totalExpense").innerText = totalExpense;
  document.getElementById("totalBalance").innerText = totalIncome-totalExpense;

  drawChart();
}

/* ================= UI ================= */
function toggleMonth(i) {
  const el = document.getElementById("body-"+i);
  el.style.display = el.style‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ©‡Æ∞‡Øç === "block" ? "none" : "block";
}

/* ================= STORAGE ================= */
function save() {
  localStorage.setItem("budgetData", JSON.stringify(data));
  render();
}

function backupData() {
  const blob = new Blob([JSON.stringify(data)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "budget_backup.json";
  a.click();
}

function importData() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json";
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      data = JSON.parse(reader.result);
      save();
    };
    reader.readAsText(file);
  };
  input.click();
}

/* ================= CHART ================= */
let chart;
function toggleChart(){
  const c = document.getElementById("chart");
  c.style.display = c.style.display==="none" ? "block" : "none";
  drawChart();
}

function drawChart(){
  const ctx = document.getElementById("chart");
  if(chart) chart.destroy();

  const incomes = data.map(m=>m.salary+m.extra+m.items.filter(i=>i.type==="income").reduce((s,a)=>s+a.amount,0));
  const expenses = data.map(m=>m.items.filter(i=>i.type==="expense").reduce((s,a)=>s+a.amount,0));

  chart = new Chart(ctx,{
    type:"line",
    data:{
      labels:monthNames,
      datasets:[
        {label:"‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö", data:incomes},
        {label:"‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢", data:expenses}
      ]
    }
  });
}

/* ================= INIT ================= */
render();
</script>
</body>
</html>
